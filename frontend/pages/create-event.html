<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crea Evento - EventHub</title>
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <style>
        .page-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: var(--spacing-2xl) 0;
            margin-bottom: var(--spacing-2xl);
        }

        .page-header h1 {
            font-size: var(--font-size-2xl);
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-2xl);
        }

        .form-actions .btn {
            flex: 1;
        }

        #alertContainer {
            margin-bottom: var(--spacing-lg);
        }

        .checkbox-group {
            display: flex;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-md);
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <!-- PAGE HEADER -->
    <div class="page-header">
        <div class="container">
            <h1>➕ Crea un Nuovo Evento</h1>
            <p style="margin-top: var(--spacing-md); opacity: 0.9;">Organizza un evento straordinario</p>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="container">
        <div class="form-container">
            <div id="alertContainer"></div>

            <form id="createEventForm">
                <!-- TITOLO E DESCRIZIONE -->
                <div class="form-group">
                    <label for="title">Titolo dell'Evento *</label>
                    <input 
                        type="text" 
                        id="title" 
                        name="title" 
                        required 
                        placeholder="Es: Conferenza Node.js 2025"
                        maxlength="100">
                </div>

                <div class="form-group">
                    <label for="description">Descrizione *</label>
                    <textarea 
                        id="description" 
                        name="description" 
                        required 
                        placeholder="Descrivi l'evento in dettaglio..."
                        rows="5"
                        maxlength="1000"></textarea>
                </div>

                <!-- DATA E ORA -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="date">Data *</label>
                        <input type="date" id="date" name="date" required>
                    </div>

                    <div class="form-group">
                        <label for="time">Ora di Inizio *</label>
                        <input type="time" id="time" name="time" required>
                    </div>
                </div>

                <!-- DURATA E CAPACITÀ -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="duration">Durata (minuti) *</label>
                        <input 
                            type="number" 
                            id="duration" 
                            name="duration" 
                            required 
                            min="15"
                            max="1440"
                            placeholder="Es: 120">
                    </div>

                    <div class="form-group">
                        <label for="capacity">Capacità Massima *</label>
                        <input 
                            type="number" 
                            id="capacity" 
                            name="capacity" 
                            required 
                            min="1"
                            max="10000"
                            placeholder="Es: 100">
                    </div>
                </div>

                <!-- LOCATION -->
                <div class="form-group">
                    <label for="location">Luogo *</label>
                    <input 
                        type="text" 
                        id="location" 
                        name="location" 
                        required 
                        placeholder="Es: Roma, Italia"
                        maxlength="100">
                </div>

                <!-- CATEGORIA -->
                <div class="form-group">
                    <label for="category">Categoria *</label>
                    <select id="category" name="category" required>
                        <option value="">-- Seleziona una categoria --</option>
                        <option value="conferenza">Conferenza</option>
                        <option value="workshop">Workshop</option>
                        <option value="festa">Festa/Social</option>
                        <option value="sportivo">Evento Sportivo</option>
                        <option value="culturale">Evento Culturale</option>
                        <option value="aziendale">Aziendale</option>
                        <option value="educativo">Educativo</option>
                        <option value="altro">Altro</option>
                    </select>
                </div>

                <!-- OPZIONI EVENTO -->
                <div class="form-group">
                    <label>Opzioni</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="isPublic" name="isPublic" checked>
                            Evento Pubblico
                        </label>
                        <label>
                            <input type="checkbox" id="requiresApproval" name="requiresApproval">
                            Richiedi Approvazione
                        </label>
                        <label>
                            <input type="checkbox" id="enableChat" name="enableChat" checked>
                            Abilita Chat
                        </label>
                    </div>
                </div>

                <!-- IMMAGINE URL -->
                <div class="form-group">
                    <label for="imageUrl">URL Immagine (Opzionale)</label>
                    <input 
                        type="url" 
                        id="imageUrl" 
                        name="imageUrl" 
                        placeholder="https://example.com/image.jpg">
                </div>

                <!-- ACTIONS -->
                <div class="form-actions">
                    <a href="dashboard.html" class="btn btn-outline">Annulla</a>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Crea Evento</button>
                </div>
            </form>
        </div>
    </main>


    <script type="module">
        import { getNavbarHTML, setupNavbar } from '../js/navbar.js';
        document.getElementById('navbar-placeholder').innerHTML = getNavbarHTML();
        setupNavbar();
    </script>
    <script src="../js/main.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/events.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        checkAuth();

        // Data minima = oggi
        document.getElementById('date').min = new Date().toISOString().split('T')[0];

        document.getElementById('createEventForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                title: document.getElementById('title').value.trim(),
                description: document.getElementById('description').value.trim(),
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                location: document.getElementById('location').value.trim(),
                duration: parseInt(document.getElementById('duration').value),
                capacity: parseInt(document.getElementById('capacity').value),
                category: document.getElementById('category').value,
                isPublic: document.getElementById('isPublic').checked,
                requiresApproval: document.getElementById('requiresApproval').checked,
                enableChat: document.getElementById('enableChat').checked,
                imageUrl: document.getElementById('imageUrl').value || null
            };

            // Combina data e ora
            formData.dateTime = new Date(formData.date + 'T' + formData.time).toISOString();

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner"></span> Creazione in corso...';

            try {
                const result = await eventManager.createEvent(formData);

                if (result.success) {
                    showAlert('✅ Evento creato con successo!', 'success');
                    setTimeout(() => {
                        window.location.href = `event-detail.html?id=${result.event._id}`;
                    }, 1500);
                } else {
                    showAlert('❌ ' + result.error, 'error');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Crea Evento';
                }
            } catch (error) {
                showAlert('❌ Errore: ' + error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Crea Evento';
            }
        });

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            alertContainer.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>